# Deep Q Network 

## Why use DQN?
### ランダム性
一回のトレードで正解データを求めるのは直感に反している。為替市場はほぼランダムウォークであり、100%勝てることはない正しいトレードをしても負けるし、適当に買っても勝つことがある。

トレードには正しい勝ち方、正しい負け方があり、トータルで勝てれば良い。それを学習させるにはいくつかのトレードから損益率を出して学習させるのが直感的。

### 時系列性
トレードはある時点で買うか売るかをして終わりではない。一般的にある時点で買った場合にどのタイミングで売却するかまでが重要である。そのため、買ってから売るまでの行動に対して報酬を与えられる強化学習が適している。

## How use DQN?
### ロスカットの対応
深層学習は中身がブラックボックスかつ相場はランダム性が高いため、いつか大きな損失をだすかもしれない。そのためロスカットを設ける必要がある。
一回のトレードを損失2%(ハイパーパラメータ)とすれば、その範囲で学習を行うはず。

### 報酬
ランダム性を除去するため、複数のトレードの結果から、損益率をだしてそれを報酬とする。
損益率が＋なら1, 損益率が-なら-1
損益率をだすトレード数は最低でも20は欲しい。バッチサイズごとに損益率を出して行う


### ロスカット
モデルに学習させる時の資金を100万としてモデルの出力lotからロスカットラインを算出して計算を行う。
実際に使用するときは数量を資金割合で調整してから使用する。
最大ロスカット範囲をハイパーパラメータで決める。

### アクション(出力)
出力はポジションを持ってるか、持ってないかで動的に変化する
 - ポジションを持っていない時
	- losscut 0-1
		- 最大losscut範囲のうちの割合。0.5なら半分にロスカットを行う。
		数量はそれから計算する。
	- buy 0-1
	- sell 0-1
	- stay 0-1
		- buy, sell, stayの内一番高い確率を選択とする
 - ポジションを持っている時
	 - longであればsellかstayか
	 - shortであればbuyかstayか 

### 入力
入力はあるウィンドウサイズ分(ハイパーパラメータ)の4H, 1H, 15Mである。
15分足のタイミングで売り買いをおこなう。
15Mなのはトレード数が多いほど、学習しやすいのと、成績は安定する(なんとかの法則)からである。(その分、スプレッドの影響を受けやすいという欠点もある)

### ハイパーパラメータ
losscut_range : losscutlineの最大下げ幅
asset: 使用する資金
allowable_loss: 許容する損失
window_size: 入力のウィンドウサイズ

